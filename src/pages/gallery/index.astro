---
// src/pages/gallery/index.astro
import ListLayout from '@/layouts/ListLayout.astro';
import { Card } from '@/components/ui/card';
import { Calendar, Images, ArrowRight } from 'lucide-react';
import galleryData from '@/data/gallery.json';

const data = galleryData.data.slice().reverse();

// Format tanggal
function formatDate(dateString: string) {
  const date = new Date(dateString);
  return new Intl.DateTimeFormat('id-ID', {
    day: 'numeric',
    month: 'long',
    year: 'numeric'
  }).format(date);
}
---

<ListLayout 
  title="Galeri Saadatuddaraein" 
  description="Dokumentasi kegiatan dan momen berharga di pondok pesantren"
  columns={3}
>
  {data.map((gallery) => (
    <div 
      class="gallery-card-wrapper group relative overflow-hidden border-0 shadow-lg hover:shadow-2xl transition-all duration-500 rounded-2xl bg-gray-900"
    >
      <!-- Background Image -->
      <div class="absolute inset-0 w-full h-full gallery-image-container">
        <img
          src={gallery.url[0]}
          alt={gallery.title}
          class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
        />
      </div>
      
      <!-- Gradient Overlay -->
      <div class="gallery-gradient absolute inset-0 w-full h-full pointer-events-none"></div>

      <!-- Content Container -->
      <div class="absolute bottom-0 left-0 right-0 flex flex-col p-6 text-white gallery-content">
        <!-- Title -->
        <h2 class="text-3xl font-bold leading-tight mb-2 gallery-title">
          {gallery.title}
        </h2>

        <!-- Description -->
        <p class="text-sm mb-4 line-clamp-2 gallery-description">
          {gallery.description || "Suasana belajar yang kondusif dan menyenangkan di kelas"}
        </p>

        <!-- Meta Info -->
        <div class="flex items-center gap-4 text-sm mb-4 gallery-meta">
          <div class="flex items-center gap-1.5">
            <Images className="w-4 h-4" />
            <span>{gallery.url.length} foto</span>
          </div>
          <div class="flex items-center gap-1.5">
            <Calendar className="w-4 h-4" />
            <time datetime={gallery.created_at}>
              {formatDate(gallery.created_at)}
            </time>
          </div>
        </div>

        <!-- Call to Action Button -->
        <a 
          href={`/gallery/${gallery.id}`}
          class="gallery-button inline-flex items-center justify-center gap-2 rounded-full font-bold transition-all duration-300 group-hover:translate-x-1"
          onclick="event.stopPropagation()"
        >
          <span>Read more</span>
          <ArrowRight className="w-4 h-4" />
        </a>
      </div>

      <!-- Full Card Link -->
      <a 
        href={`/gallery/${gallery.id}`}
        class="absolute inset-0 gallery-link"
        aria-label={`View ${gallery.title}`}
      />
    </div>
  ))}

  <!-- Empty State -->
  {data.length === 0 && (
    <div slot="empty" class="col-span-full flex min-h-[400px] items-center justify-center">
      <div class="text-center">
        <Images className="mx-auto h-12 w-12 text-muted-foreground mb-4" />
        <h3 class="text-lg font-semibold text-foreground mb-2">
          Belum ada album foto
        </h3>
        <p class="text-sm text-muted-foreground">
          Album foto akan muncul di sini setelah ditambahkan
        </p>
      </div>
    </div>
  )}
</ListLayout>

<style is:global>
  /* Card Wrapper */
  .gallery-card-wrapper {
    position: relative !important;
    aspect-ratio: 3/4 !important;
    min-height: 400px !important;
    width: 100% !important;
    height: 100% !important;
  }
  
  /* Image Container */
  .gallery-image-container {
    z-index: 1 !important;
  }
  
  /* Gradient Overlay - ALWAYS VISIBLE */
  .gallery-gradient {
    z-index: 5 !important;
    background: linear-gradient(to top, 
      rgba(0, 0, 0, 1) 0%, 
      rgba(0, 0, 0, 0.85) 30%, 
      rgba(0, 0, 0, 0.6) 50%, 
      rgba(0, 0, 0, 0.3) 70%, 
      transparent 100%
    ) !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
  }
  
  /* Content */
  .gallery-content {
    z-index: 10 !important;
  }
  
  /* Title */
  .gallery-title {
    color: white !important;
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.8) !important;
  }
  
  /* Description */
  .gallery-description {
    color: rgba(255, 255, 255, 0.95) !important;
    text-shadow: 0 1px 4px rgba(0, 0, 0, 0.8) !important;
  }
  
  /* Meta Info */
  .gallery-meta {
    color: rgba(255, 255, 255, 0.9) !important;
    text-shadow: 0 1px 4px rgba(0, 0, 0, 0.8) !important;
  }
  
  .gallery-meta span,
  .gallery-meta time {
    color: rgba(255, 255, 255, 0.9) !important;
  }
  
  /* Button */
  .gallery-button {
    background-color: rgb(34, 197, 94) !important;
    color: white !important;
    z-index: 50 !important;
    position: relative !important;
    pointer-events: auto !important;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3) !important;
    padding: 0.625rem 1.25rem !important;
    width: fit-content !important;
    text-decoration: none !important;
    display: inline-flex !important;
  }
  
  .gallery-button:hover {
    background-color: rgb(22, 163, 74) !important;
  }
  
  .gallery-button span {
    color: white !important;
  }
  
  /* Card Link */
  .gallery-link {
    z-index: 2 !important;
  }
  
  /* Override any grid constraints from ListLayout */
  [data-gallery-grid] > * {
    min-height: 400px !important;
  }
</style>