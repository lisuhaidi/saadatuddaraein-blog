---
import Layout from '@/layouts/Layout.astro';
---

<Layout title="Tambah Gallery">
  <div class="container mx-auto p-4">
    <h1 class="mb-6 text-3xl font-bold">Tambah Gallery</h1>

    <form id="formGallery" class="space-y-4 rounded-lg bg-white p-6 shadow-md dark:bg-gray-800">
      <div>
        <label for="id" class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">ID</label>
        <input type="text" id="id" name="id" placeholder="ID" required class="w-full rounded-md border border-gray-300 p-2 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-600 dark:bg-gray-700 dark:text-white" />
      </div>
      <div>
        <label for="title" class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">Title</label>
        <input type="text" id="title" name="title" placeholder="Title" required class="w-full rounded-md border border-gray-300 p-2 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-600 dark:bg-gray-700 dark:text-white" />
      </div>
      <div>
        <label for="description" class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">Description</label>
        <textarea id="description" name="description" placeholder="Description" class="w-full rounded-md border border-gray-300 p-2 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-600 dark:bg-gray-700 dark:text-white"></textarea>
      </div>
      <div>
        <label for="urls" class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">Image URLs (one per line)</label>
        <textarea id="urls" name="urls" placeholder="Masukkan link gambar, satu per baris" required class="w-full rounded-md border border-gray-300 p-2 focus:border-blue-500 focus:ring focus:ring-blue-200 dark:border-gray-600 dark:bg-gray-700 dark:text-white"></textarea>
      </div>

      <button type="submit" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">Simpan</button>
       <a 
          href="/admin/gallery"
          class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-gray-300 bg-white hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-600 dark:hover:bg-gray-700 h-10 px-4 py-2"
        >
          Kembali
        </a>
    </form>

    <script>
      const form = document.getElementById("formGallery");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const formData = new FormData(form);

        const urls = formData.get("urls").split("\n").map((u) => u.trim()).filter(Boolean);

        const payload = {
          id: formData.get("id"),
          title: formData.get("title"),
          description: formData.get("description"),
          url: urls,
        };

        await fetch("/api/gallery/add-gallery", {
          method: "POST",
          body: JSON.stringify(payload),
        });
        
        alert("Gallery berhasil disimpan."); // Consider a more user-friendly notification
        form.reset(); // Clear the form after successful submission
      });
    </script>
</Layout>
